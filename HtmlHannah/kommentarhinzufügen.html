<!Doctype html>
<html>

	<head>
			<title>Klettertourenbuch Kuchl</title>
			<meta charset="utf-8">
			<link rel="stylesheet" href="routenDetail.css">
		
		<style>
			
			body {
				background-color:#333333;
				}
			
			.kommentarhinzufügen {
				background-color: white;
				margin: 10% 20%;
				padding: 5%}
		
			.kommentarhinzufügen p {
				font-size: 120%;
				font-weight: bold;}
				
			.kommentarhinzufügen button {
				margin: 1%;
				padding: 1%;
				background-color: #555555;
				color: white;
				border: 2px solid #555555;
				font-weight: bold;
				}

			.kommentarhinzufügen button:hover {
				  background-color: white;
				  color: black;	}
		
		</style>

		</head>
		
	<body>

			<div class="kommentarhinzufügen">
				<p> Kommentar:
					<input type="text" id="comment">
				</p>
				
				<p> Schwierigkeitsbewertung:
					<input type="text" id="sugDiff">
				</p>
				
				<button id="b1" onClick="sendAcces()">Senden</button>
			</div>
		
		</body>

    <script>
         
        Rname =  sessionStorage.getItem('tourName');
        RDiff =  sessionStorage.getItem('tourDiff');

        function sendAcces() {

            //check if the user is logged in
            listOfCookies = decodeURIComponent(document.cookie).split(";");
            if(listOfCookies[0] == ""){
                alert("Bitte Einloggen!");
                return 0;
            }
            //There is a log in cookie
            usrName = listOfCookies[0].split("=")[0];
            pw = listOfCookies[0].split("=")[1];
            //get all the info from the text Fields
            diff = document.getElementById("sugDiff").value.trim();
            comment = document.getElementById("comment").value.trim();
            //
            console.log(usrName);
            //test if the entered values are valid
            if(isValidAccent(usrName,diff,comment)==false){
                alert("Sorry, falsche Eingabe. Bitte keine Sonderzeichen");
                return 0;
            }

            // //send the accend to the server

            params = Rname + "||" + RDiff + "||" + usrName + "||" + comment + "||" + diff.replace("+","%2B").replace("-","%2D") + "||"+(new Date()).getTime();

            var xhttp = new XMLHttpRequest();
            xhttp.onload = function () {
                if(this.responseText.trim()=="OK"){
                    alert("Tour Hinzugefügt");
                    location.href = "/HtmlHannah/routenDetail.html";
                }else{
                    alert("Sorry! Irgentetwas hat nicht funktioniert");
                }
            };
            xhttp.open("GET", "http://kletterapp.atwebpages.com/Php/addAccent.php?text="+params+"&name="+usrName+"&pw="+pw, true);
            xhttp.send();
            //gray out the button
            document.getElementById("b1").disabled=true;            
        }
     
        function isValidAccent(name,diff,comment){

            //test if the name is valid (no special chars)
            if (isValidText(name) == true) return false;

            //test if the name is not empty (bigger than 2)
            if(name.length <= 2) return false;
 
            //test if the difficulty is valid
            if (isValidDifficulty(diff) == false) return false;
 
            //test if the comment is valid (no special chars)
            if (isValidText(comment) == true) return false;

            //test if the comment doesn't include any blacklisted words

            return true;

        }

        function isValidDifficulty(dif){
            //regexp
            //French
            var patF = /^[2-9][abc]$/;
            //Austrian
            var patA = /^([1-9][1-2]?)([+-])?$/;
            return  patF.test(dif) || patA.test(dif);
        }

        function isValidText(name){
            //regexp
            var pat = /[äöüß?&<\\+-<;]/i;
            return pat.test(name);
        }


    </script>

</html>